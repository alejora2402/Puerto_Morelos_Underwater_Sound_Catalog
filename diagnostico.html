<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Diagnóstico de recursos – Catálogo PM</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:24px;background:#0b1020;color:#e8ecf1}
    h1{margin:0 0 16px 0}
    table{width:100%;border-collapse:collapse;font-size:14px}
    th,td{padding:8px;border-bottom:1px solid #24345f;text-align:left}
    .ok{color:#9ae6b4;font-weight:600}
    .err{color:#feb2b2;font-weight:600}
    .small{opacity:.8;font-size:12px}
    a{color:#88b4ff}
    .tag{font-weight:600;color:#a5b8ff}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#1f2a4a;color:#b9c9ec;font-size:12px;margin-left:8px}
  </style>
</head>
<body>
  <h1>Diagnóstico de recursos – Catálogo Puerto Morelos</h1>
  <p class="small">Este diagnóstico carga <code>data.js</code> y verifica (con solicitudes <b>HEAD</b>) la existencia de cada <span class="tag">Clip</span> y <span class="tag">Spectrogram</span>. Úsalo en GitHub Pages para detectar rutas con error 404, diferencias de mayúsculas/minúsculas, espacios o tildes.</p>
  <div id="summary"></div>
  <table id="tbl">
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Clip</th>
        <th>Estado</th>
        <th>Espectrograma</th>
        <th>Estado</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script src="data.js"></script>
  <script>
    async function head(url){
      try{
        const r = await fetch(encodeURI(url), {method:'HEAD'});
        return r.ok ? {ok:true,status:r.status} : {ok:false,status:r.status};
      }catch(e){
        return {ok:false,status:-1,err:e.message};
      }
    }

    function textStatus(res){
      if(res.ok) return '<span class="ok">OK ('+res.status+')</span>';
      if(res.status===404) return '<span class="err">404 No encontrado</span>';
      return '<span class="err">Error '+res.status+'</span>';
    }

    (async function(){
      const tbody = document.querySelector('#tbl tbody');
      let ok=0, fail=0;
      for(const row of (window.catalogo||[])){
        const tr = document.createElement('tr');
        const clip = row["Clip File"]||"";
        const spec = row["Spectrogram File"]||"";
        const [rc, rs] = await Promise.all([head(clip), head(spec)]);
        if(rc.ok) ok++; else fail++;
        if(rs.ok) ok++; else fail++;

        tr.innerHTML = '<td>'+ (row["Nombre"]||"—") + (row["ID"]? ' <span class="pill">'+row["ID"]+'</span>':'' ) + '</td>' +
                       '<td><a href="'+encodeURI(clip)+'" target="_blank">'+clip+'</a></td>' +
                       '<td>'+ textStatus(rc) +'</td>' +
                       '<td><a href="'+encodeURI(spec)+'" target="_blank">'+spec+'</a></td>' +
                       '<td>'+ textStatus(rs) +'</td>';
        tbody.appendChild(tr);
      }
      document.getElementById('summary').innerHTML = '<p><b>Resumen:</b> Recursos OK: '+ok+' | Fallidos: '+fail+'</p>';
    })();
  </script>
</body>
</html>
